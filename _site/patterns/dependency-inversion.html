<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width">

        <title>F# by Example : Dependency inversion</title>
        <meta name="description" content="For people in a hurry">

        <link href="/assets/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="/css/syntax.css">
        <link rel="stylesheet" href="/css/main.css">
    </head>
    <body>

        <div class="container">
            <div class="row">
                <div id="header" class="col-sm-12">
                    <h4><a class="brand" href="/">F# by Example</a>
    <small>For people in a hurry</small>
</h4>

                </div>
            </div>

            <div class="row">
                
                
                    <div id="navigation" class="col-sm-2">
                        <ul class="nav nav-list">
    
        
        

        
            
                <li class="nav-header">Syntax</li>
            
            <li data-order="">
                <a href="/syntax/pattern-matching.html">Pattern matching</a>
            </li>
        
            
            <li data-order="">
                <a href="/syntax/if-statements.html">If statements</a>
            </li>
        
            
            <li data-order="">
                <a href="/syntax/functions.html">Functions</a>
            </li>
        
            
            <li data-order="">
                <a href="/syntax/variables.html">Variables</a>
            </li>
        
    
        
        

        
            
                <li class="nav-header">Types</li>
            
            <li data-order="">
                <a href="/types/interfaces.html">Interfaces</a>
            </li>
        
            
            <li data-order="">
                <a href="/types/aliases.html">Aliases</a>
            </li>
        
            
            <li data-order="">
                <a href="/types/classes.html">Classes</a>
            </li>
        
            
            <li data-order="">
                <a href="/types/unions.html">Unions</a>
            </li>
        
            
            <li data-order="">
                <a href="/types/records.html">Records</a>
            </li>
        
            
            <li data-order="">
                <a href="/types/tuples.html">Tuples</a>
            </li>
        
    
        
        

        
            
                <li class="nav-header">Design patterns</li>
            
            <li data-order="">
                <a href="/patterns/polymorphism.html">Polymorphism</a>
            </li>
        
            
            <li data-order="">
                <a href="/patterns/dependency-inversion.html">Dependency inversion</a>
            </li>
        
    
        
        

        
            
                <li class="nav-header">Projects</li>
            
            <li data-order="">
                <a href="/projects/namespaces.html">Namespaces</a>
            </li>
        
            
            <li data-order="">
                <a href="/projects/ordering.html">Ordering</a>
            </li>
        
            
            <li data-order="">
                <a href="/projects/modules.html">Modules</a>
            </li>
        
    
        
        

        
            
                <li class="nav-header">Data access</li>
            
            <li data-order="">
                <a href="/data/query-syntax.html">Query syntax</a>
            </li>
        
            
            <li data-order="">
                <a href="/data/type-providers.html">Type providers</a>
            </li>
        
    
        
        

        
            
                <li class="nav-header">Testing</li>
            
            <li data-order="">
                <a href="/testing/property-based-testing.html">Property based testing</a>
            </li>
        
            
            <li data-order="">
                <a href="/testing/fsunit.html">FsUnit</a>
            </li>
        
    
        
        

        
            
                <li class="nav-header">Runtime</li>
            
            <li data-order="">
                <a href="/runtime/browser.html">Browser</a>
            </li>
        
            
            <li data-order="">
                <a href="/runtime/net-interop.html">.NET Interop</a>
            </li>
        
    
<!-- List additional links. It is recommended to add a divider
    e.g. <li class="divider"></li> first to break up the content. -->
</ul>

                    </div>

                    <div id="content" class="col-sm-10">
                        <div class="page-header">
    <h2>Dependency inversion
        
    </h2>
</div>

<p>Depencency inversion can be accomplished by providing your service instances as parameters passed to your domain functions. The service instances can be provided as single functions or implementations of interfaces.
This is analagous to constructor injection in Object Orientated programming.</p>

<h4 id="service-as-a-function">Service as a function</h4>

<div class="row">
    <div class="col-md-6">
        
We define a `Logger` type alias to act as our interface.

    </div>
    <div class="col-md-6">
        

<figure class="highlight"><pre><code class="language-fsharp" data-lang="fsharp"><span class="k">type</span> <span class="nc">Logger</span> <span class="p">=</span> <span class="kt">string</span> <span class="p">-&gt;</span> <span class="kt">unit</span></code></pre></figure>


    </div>
</div>

<div class="row">
    <div class="col-md-6">
        
We can then inject an instance of our `Logger` type into domain code. In this example, we are calculating the end of quarter bank balance for a company.

    </div>
    <div class="col-md-6">
        

<figure class="highlight"><pre><code class="language-fsharp" data-lang="fsharp"><span class="k">let</span> <span class="n">calculateBalance</span> <span class="p">(</span><span class="n">logger</span><span class="p">:</span> <span class="nc">Logger</span><span class="p">)</span> <span class="n">revenue</span> <span class="n">costs</span> <span class="n">taxRate</span> <span class="p">=</span> 
    <span class="k">let</span> <span class="n">profit</span> <span class="p">=</span> <span class="n">revenue</span> <span class="p">-</span> <span class="n">costs</span>
    <span class="n">logger</span> <span class="p">(</span><span class="s2">"Total profit: "</span> <span class="o">+</span> <span class="n">profit</span><span class="p">.</span><span class="nc">ToString</span><span class="bp">()</span><span class="p">)</span>
    
    <span class="k">let</span> <span class="n">taxAmount</span> <span class="p">=</span> <span class="n">profit</span> <span class="p">*</span> <span class="n">taxRate</span>
    <span class="n">logger</span> <span class="p">(</span><span class="s2">"Total tax: "</span> <span class="o">+</span> <span class="n">profit</span><span class="p">.</span><span class="nc">ToString</span><span class="bp">()</span><span class="p">)</span>

    <span class="k">let</span> <span class="n">balance</span> <span class="p">=</span> <span class="n">profit</span> <span class="p">-</span> <span class="n">taxAmount</span>
    <span class="n">logger</span> <span class="p">(</span><span class="s2">"Remaining balance: "</span> <span class="o">+</span> <span class="n">balance</span><span class="p">.</span><span class="nc">ToString</span><span class="bp">()</span><span class="p">)</span>
    
    <span class="n">balance</span></code></pre></figure>


    </div>
</div>

<div class="language-fsharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// We can then inject an instance of our `Logger` type into domain code. In this example, we are calculating the end of quarter bank balance for a company.</span>
<span class="k">let</span> <span class="n">calculateBalance</span> <span class="p">(</span><span class="n">logger</span><span class="p">:</span> <span class="nc">Logger</span><span class="p">)</span> <span class="n">revenue</span> <span class="n">costs</span> <span class="n">taxRate</span> <span class="p">=</span> 
    <span class="k">let</span> <span class="n">profit</span> <span class="p">=</span> <span class="n">revenue</span> <span class="p">-</span> <span class="n">costs</span>
    <span class="n">logger</span> <span class="p">(</span><span class="s2">"Total profit: "</span> <span class="o">+</span> <span class="n">profit</span><span class="p">.</span><span class="nc">ToString</span><span class="bp">()</span><span class="p">)</span>
    
    <span class="k">let</span> <span class="n">taxAmount</span> <span class="p">=</span> <span class="n">profit</span> <span class="p">*</span> <span class="n">taxRate</span>
    <span class="n">logger</span> <span class="p">(</span><span class="s2">"Total tax: "</span> <span class="o">+</span> <span class="n">profit</span><span class="p">.</span><span class="nc">ToString</span><span class="bp">()</span><span class="p">)</span>

    <span class="k">let</span> <span class="n">balance</span> <span class="p">=</span> <span class="n">profit</span> <span class="p">-</span> <span class="n">taxAmount</span>
    <span class="n">logger</span> <span class="p">(</span><span class="s2">"Remaining balance: "</span> <span class="o">+</span> <span class="n">balance</span><span class="p">.</span><span class="nc">ToString</span><span class="bp">()</span><span class="p">)</span>
    
    <span class="n">balance</span>
</code></pre></div></div>

<div class="language-fsharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// You can then use [Partial Application](/syntax/partial-application) to bind a service instance to the function.</span>
<span class="c1">// For testing</span>
<span class="k">let</span> <span class="n">nullLogger</span> <span class="n">str</span> <span class="p">=</span> <span class="bp">()</span>
<span class="c1">// For productions</span>
<span class="k">let</span> <span class="n">consoleLogger</span> <span class="n">str</span> <span class="p">=</span> <span class="nn">System</span><span class="p">.</span><span class="nn">Console</span><span class="p">.</span><span class="nc">WriteLine</span><span class="p">(</span><span class="n">str</span><span class="p">)</span>

<span class="k">let</span> <span class="n">calcBalanceTesting</span> <span class="p">=</span> <span class="n">calculateBalance</span> <span class="n">nullLogger</span>
<span class="k">let</span> <span class="n">calcBalanceProduction</span> <span class="p">=</span> <span class="n">calculateBalance</span> <span class="n">consoleLogger</span>

<span class="k">let</span> <span class="n">balance</span> <span class="p">=</span> <span class="n">calcBalanceTesting</span> <span class="mi">100</span><span class="n">m</span> <span class="mi">70</span><span class="n">m</span> <span class="mi">0</span><span class="p">.</span><span class="mi">2</span><span class="n">m</span>
</code></pre></div></div>

<h4 id="service-as-an-interface">Service as an interface</h4>
<p>Instead of using a type alias you can use a regular interface to define your service APIs.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>type ILogger =
    abstract member this.Info(msg: string): unit
</code></pre></div></div>
<p>And then you can use it in the function as so.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>


                    </div>
                
            </div>

            

            <div class="row">
                <div id="footer" class="col-sm-12">
                    Documentation for <a href="https://github.com/bruth/jekyll-docs-template">F# by Example</a>

                </div>
            </div>
        </div>

        <script>
            function orderNav() {
                var list,
                    section,
                    header,
                    sections = [],
                    lists = {},
                    headers = {};

                var navUl = document.querySelectorAll('#navigation ul')[0],
                    navLis = document.querySelectorAll('#navigation ul li');

                if (!navUl) return;

                for (var i = 0; i < navLis.length; i++) {
                    var order, li = navLis[i];

                    if (li.classList.contains('nav-header')) {
                        section = li.textContent || li.innerText;
                        sections.push(section);
                        headers[section] = li;
                        continue;
                    }

                    if (!lists[section]) {
                        lists[section] = [];
                    }

                    order = parseFloat(li.getAttribute('data-order'))
                    lists[section].push([order, li]);
                }

                for (var i = 0; i < sections.length; i++) {
                    section = sections[i];
                    list = lists[section].sort(function(a, b) {
                        return a[0] - b[0];
                    });

                    if (header = headers[section]) {
                        navUl.appendChild(header);
                    }
                    for (var j = 0; j < list.length; j++) {
                        navUl.appendChild(list[j][1]);
                    }
                }
            }

            if (document.querySelectorAll) orderNav();
        </script>
        
    </body>
</html>
